<div class="min-h-screen bg-white flex justify-center px-4">
  <div class="w-full max-w-3xl py-10 space-y-10">
    
    <!-- Home Button -->
    <button
      (click)="goHome()"
      class="bg-rose-300 border-b-4 border-rose-400 text-white font-bold py-1 px-4 rounded-2xl transition-all duration-500 transform active:translate-y-1 active:border-b-0"
    >
      <i class="fa-solid fa-house"></i>
      Home
    </button>

    <!-- Header -->
    <header class="flex items-center justify-between">
      <h1 class="text-2xl font-extrabold text-gray-800">
        {{ courseName }}
      </h1>

      <div class="flex items-center gap-2 bg-rose-100 px-3 py-1 rounded-full shadow">
        <span class="text-red-500 text-lg">❤️</span>
        <span class="font-semibold text-gray-700">
          {{ heartsRemaining }}
        </span>
      </div>
    </header>

    <!-- OUTER LOOP: Iterate over Units -->
    @for (unit of units; track unit.id) {

      <!-- Unit Card (Dynamic Background Color) -->
      <section
        class="text-white rounded-2xl p-6 shadow-lg flex flex-col gap-3"
        [style.backgroundColor]="unit.theme.primary"
      >
        <div class="flex items-center gap-3 text-sm font-semibold opacity-90">
          <span>{{ unit.sectionTitle }}</span>
          <span>•</span>
          <span>{{ unit.unitTitle }}</span>
        </div>

        <h2 class="text-xl font-bold leading-tight">
          {{ unit.unitDescription }}
        </h2>
      </section>

      <!-- Lessons for this Unit -->
      <section class="space-y-8 pb-8">
        
        <div class="flex flex-col items-center gap-4">
          @for (lesson of unit.lessons; track lesson.id) {

          <div
            class="flex flex-col items-center gap-3"
            [style.marginLeft.px]="lesson.offset"
          >
            <!-- Lesson Button (Dynamic Colors based on Unit Theme) -->
            <!-- Note: We use style bindings for the dynamic colors, but keep gray for Locked state -->
            <button
              (click)="openLesson(lesson)"
              class="lesson-button relative rounded-full flex items-center justify-center border-b-8 transform transition-all duration-500 ease-out lg:mb-0 mb-4"
              
              [style.backgroundColor]="lesson.progress !== 'Locked' ? unit.theme.primary : ''"
              [style.borderColor]="lesson.progress !== 'Locked' ? unit.theme.secondary : ''"
              
              [class.bg-gray-300]="lesson.progress === 'Locked'"
              [class.border-gray-400]="lesson.progress === 'Locked'"
              [class.active:translate-y-2]="lesson.progress !== 'Locked'"
              [class.active:border-b-0]="lesson.progress !== 'Locked'"
              [class.cursor-not-allowed]="lesson.progress === 'Locked'"
              [attr.data-locked]="lesson.progress === 'Locked'"
              [attr.data-primary-color]="unit.theme.primary" 
              [attr.data-secondary-color]="unit.theme.secondary"
            >
              <!-- Left Eye -->
              <svg class="eye left-eye" viewBox="0 0 24 24">
                <ellipse cx="12" cy="12" rx="4" ry="6" fill="white" />
              </svg>

              <!-- Right Eye -->
              <svg class="eye right-eye" viewBox="0 0 24 24">
                <ellipse cx="12" cy="12" rx="4" ry="6" fill="white" />
              </svg>

              <!-- Nose -->
              <svg class="nose" viewBox="0 0 24 24">
                <ellipse cx="12" cy="12" rx="3" ry="2.5" fill="white" />
              </svg>

              <!-- Mouth -->
              <svg class="mouth" viewBox="0 0 24 24">
                <path d="M6 6 Q12 12 18 6" stroke="white" stroke-width="2" fill="none" />
              </svg>
            </button>

            <span
              class="text-sm font-semibold"
              [class.text-gray-400]="lesson.progress === 'Locked'"
              [class.text-gray-700]="lesson.progress !== 'Locked'"
            >
              {{ lesson.title }}
            </span>
          </div>

          }
        </div>
      </section>
      
    } <!-- End of Unit Loop -->

  </div>
</div>

<style>
/* =========================
   BASE BUTTON SIZE (DESKTOP)
========================= */
.lesson-button {
  width: 96px;
  height: 96px;
  overflow: visible;
}

/* =========================
   EARS (Dynamic Coloring logic required slightly different approach for pure CSS)
   For simplicity, we use the currentColor or specific classes. 
   Here we rely on the component logic or use CSS variables if needed.
   To make ears match the dynamic background, we can't easily use ::before/::after with inline styles.
   
   However, for this specific request, the simplest way to color the ears dynamically 
   is to use the border-bottom-color inheritance or CSS variables.
   
   BELOW: Updated logic to use CSS Variable for dynamic colors on ears
========================= */

.lesson-button::before,
.lesson-button::after {
  content: '';
  position: absolute;
  top: -8px;
  width: 0;
  height: 0;
  border-left: 18px solid transparent;
  border-right: 18px solid transparent;
  border-bottom: 18px solid;
  /* Use inherit to grab the border color set via [style.borderColor] on the parent button */
  border-bottom-color: inherit; 
}

.lesson-button[data-locked="true"]::before,
.lesson-button[data-locked="true"]::after {
  border-bottom-color: #9ca3af !important; /* gray-400 matching locked border */
}

.lesson-button::before {
  left: 6px;
  transform: rotate(-30deg);
}

.lesson-button::after {
  right: 6px;
  transform: rotate(30deg);
}

/* =========================
   FACE ELEMENTS
========================= */
.eye { position: absolute; width: 20px; height: 26px; top: 28px; }
.left-eye { left: 22px; }
.right-eye { right: 22px; }
.nose { position: absolute; bottom: 34px; width: 24px; height: 18px; }
.mouth { position: absolute; bottom: 18px; width: 40px; height: 16px; }

/* =========================
   MOBILE ENHANCEMENT
========================= */
@media (max-width: 480px) {
  .lesson-button {
    width: 120px;
    height: 120px;
    border-bottom-width: 10px;
  }

  .lesson-button:not([data-locked="true"]):active {
    transform: translateY(10px) !important;
    border-bottom-width: 0px !important;
  }

  .lesson-button::before,
  .lesson-button::after {
    border-left-width: 22px;
    border-right-width: 22px;
    border-bottom-width: 22px;
    top: -8px;
  }

  .eye { width: 26px; height: 34px; top: 34px; }
  .left-eye { left: 28px; }
  .right-eye { right: 28px; }
  .nose { width: 30px; height: 22px; bottom: 42px; }
  .mouth { width: 48px; height: 20px; bottom: 22px; }
}
</style>
